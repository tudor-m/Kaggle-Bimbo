{
    "contents" : "## R version of most popular local hotels\nlibrary(bit64)\nlibrary(lava)\nlibrary(data.table)\nlibrary(ggplot2)\n\nsource(\"futil.R\")\n#source(\"processSubmissions.R)\")\n\n# validation:\n# 0 - TEST\n# 1 - CV\n# 2 - CV with a very small set\nVALIDATION = 2\n#VALIDATION = 1\n\ntrain <- \n  fread('../data/train.csv', header=TRUE,\n        select = c(\"Semana\",\"Agencia_ID\",\"Canal_ID\",\"Ruta_SAK\",\"Cliente_ID\",\"Producto_ID\",\"Venta_uni_hoy\",\"Venta_hoy\",\"Dev_uni_proxima\",\"Dev_proxima\",\"Demanda_uni_equil\"))\n\nif (VALIDATION == 1) # CV\n{\n  nCli = 10000;\n  set.seed(2300)\n  trainCli = sample(unique(train$Cliente_ID),nCli)\n  trainWeeks = c(3,4,5,6,7,8)\n  testWeeks = c(9)\n  idxTrain = which(train$Semana %in% trainWeeks)\n  idxTest = which(train$Semana %in% testWeeks)\n  test = train[idxTest,]\n  train = train[idxTrain,]\n  train$id = 1:nrow(train)\n  test$id = 1:nrow(test)\n}\n\nif (VALIDATION == 2) # short set of train/test for quick CV\n{\n  nCli = 10000;\n  set.seed(2300)\n  trainCli = sample(unique(train$Cliente_ID),nCli)\n  trainWeeks = c(3,4,5,6,7)\n  testWeeks = c(8)\n  idxTrain = which(train$Cliente_ID %in% trainCli & train$Semana %in% trainWeeks)\n  idxTest = which(train$Cliente_ID %in% trainCli & train$Semana %in% testWeeks)\n  test = train[idxTest,]\n  train = train[idxTrain,]\n  test$id = 1:nrow(test)\n}\n\nif (VALIDATION == 0)\n{\n  test <- \n    fread('../data/test.csv', header=TRUE,\n          select = c(\"row_id\",\"x\",\"y\",\"accuracy\",\"time\"))\n}\n\ninTrainRows = nrow(train)\ninTestRows = nrow(test)\n\n\ntop_k <- function(hc,v1,k){\n  hc_sorted <- hc[order(v1,decreasing=TRUE)]\n  n <- min(k,length(hc_sorted))\n  # n <- min(3,length(hc_sorted))\n  paste(hc_sorted[1:n],collapse=\",\")\n}\n\ntop_kk <- function(plid,n,k){\n  tt = plid[order(n,decreasing = TRUE)]\n  nn = min(k,length(tt))\n  paste( tt[1:nn],collapse=\",\")\n}\n\ntop_score_kk <- function(plid,n,k){\n  tt = n[order(n,decreasing = TRUE)]\n  nn = min(k,length(tt))\n  paste( tt[1:nn],collapse=\",\")\n}\n\ntop_prc_kk <- function(plid,n,k){\n  tt = n[order(n,decreasing = TRUE)]/sum(n)\n  nn = min(k,length(tt))\n  paste( tt[1:nn],collapse=\",\")\n}\n\ntop_bprc_kk <- function(plid,n,k,bp){\n  tt = n[order(n,decreasing = TRUE)]/sum(n)*bp\n  nn = min(k,length(tt))\n  paste( tt[1:nn],collapse=\",\")\n}\n\ntop_val_k <- function(hc,v1,k){\n  hc_sorted <- v1[order(v1,decreasing=TRUE)]\n  n <- min(k,length(hc_sorted))\n  # n <- min(3,length(hc_sorted))\n  paste(hc_sorted[1:n],collapse=\",\")\n}\n\ntop_prc_k <- function(hc,v1,k){\n  hc_sorted <- v1[order(v1,decreasing=TRUE)]\n  hc_sorted <- hc_sorted/sum(hc_sorted)\n  n <- min(k,length(hc_sorted))\n  # n <- min(3,length(hc_sorted))\n  paste(hc_sorted[1:n],collapse=\",\")\n}\n\ns_fct_mean <- function(x)\n{\n  floor(mean(x))\n}\n\nsubName = \".wip.000.csv\"\n\nestRet = list()\nestRetE = list()\ns_class_all = list()\ns_class_train_all = list()\ns_class_test_all = list()\ns_err_train_all = list()\ns_err_test_all = list()\n#######################################\nclass_name   = \"A\"\ns_feat_list = list(\"Cliente_ID\",\"Producto_ID\")\ns_fct = s_fct_mean\n\nc_feat = c(unlist(s_feat_list))\ns_class <- train[,list(s_fct(Demanda_uni_equil),.N),by=c_feat]\n\ns_class_train <- merge(train,s_class,by=c_feat,all.x=TRUE)[order(id),list(id,V1)]\ns_class_test <- merge(test,s_class,by=c_feat,all.x=TRUE)[order(id),list(id,V1)]\n\nbk = 0.4*mean(s_class_test$V1,na.rm = TRUE)\nidxna = which(is.na(s_class_test$V1))\ns_class_test[which(is.na(s_class_test$V1))] = bk\n\ns_err_train = errMeasure(s_class_train$V1,train$Demanda_uni_equil)\ns_err_test = errMeasure(s_class_test$V1,test$Demanda_uni_equil)\n\nprint(s_err_train[[1]])\nprint(s_err_test[[1]])\n\nestRetE[[class_name]] = estE\nestRet[[class_name]] = s_class_test$V1\n\ns_class_all[[class_name]] = s_class\ns_class_train_all[[class_name]] = s_class_train\ns_class_test_all[[class_name]] = s_class_test\ns_err_train_all[[class_name]] = s_err_train\ns_err_test_all[[class_name]] = s_err_test\n\n#######################################\n\n#######################################\nclass_name   = \"B\"\ns_feat_list = list(\"Ruta_SAK\",\"Producto_ID\")\ns_fct = s_fct_mean\n\nc_feat = c(unlist(s_feat_list))\ns_class <- train[,list(s_fct_mean(Demanda_uni_equil),.N),by=c_feat]\n\ns_class_train <- merge(train,s_class,by=c_feat,all.x=TRUE)[order(id),list(id,V1)]\ns_class_test <- merge(test,s_class,by=c_feat,all.x=TRUE)[order(id),list(id,V1)]\n\nbk = 0.45*mean(s_class_test$V1,na.rm = TRUE)\nidxna = which(is.na(s_class_test$V1))\ns_class_test[which(is.na(s_class_test$V1))] = bk\n\nestE = errMeasure(s_class_test$V1,test$Demanda_uni_equil)\nprint(estE[[1]])\nestRetE[[class_name]] = estE\nestRet[[class_name]] = s_class_test$V1\n#######################################\n\n\n#######################################\n# Class B:\nclass_name   = \"B\"\ns_feat_list = c(\"Ruta_SAK\",\"Producto_ID\")\ns_class <- train[,list(.N,floor(mean(Demanda_uni_equil))),by=list(Ruta_SAK,Producto_ID)]\nsetnames(s_class,c(s_feat_list,\"N\",\"V1\"))\n\ns_class_test <- merge(test,s_class,by=s_feat_list,all.x=TRUE)[order(id),list(id,V1)]\nsetnames(s_class_test,c(\"id\",\"Demanda_uni_equil\"))\n\nbk = 0.45*mean(s_class_test$Demanda_uni_equil,na.rm = TRUE)\nidxna = which(is.na(s_class_test$Demanda_uni_equil))\ns_class_test[which(is.na(s_class_test$Demanda_uni_equil))] = bk\n\nestE = errMeasure(s_class_test$Demanda_uni_equil,test$Demanda_uni_equil)\nprint(estE[[1]])\nestRetE[[class_name]] = estE\nestRet[[class_name]] = s_class_test$Demanda_uni_equil\n#######################################\n\n#######################################\n# Class C:\nclass_name   = \"C\"\ns_feat_list = c(\"Agencia_ID\",\"Producto_ID\")\ns_class <- train[,list(.N,floor(mean(Demanda_uni_equil))),by=list(Ruta_SAK,Agencia_ID)]\nsetnames(s_class,c(s_feat_list,\"N\",\"V1\"))\n\ns_class_test <- merge(test,s_class,by=s_feat_list,all.x=TRUE)[order(id),list(id,V1)]\nsetnames(s_class_test,c(\"id\",\"Demanda_uni_equil\"))\n\nbk = 0.45*mean(s_class_test$Demanda_uni_equil,na.rm = TRUE)\nidxna = which(is.na(s_class_test$Demanda_uni_equil))\ns_class_test[which(is.na(s_class_test$Demanda_uni_equil))] = bk\n\nestE = errMeasure(2.*s_class_test$Demanda_uni_equil,test$Demanda_uni_equil)\nprint(estE[[1]])\nestRetE[[class_name]] = estE\nestRet[[class_name]] = s_class_test$Demanda_uni_equil\n#######################################\n\n#######################################\n# Class D:\nclass_name   = \"D\"\ns_feat_list = c(\"Ruta_SAK\",\"Cliente_ID\")\ns_class <- train[,list(.N,floor(mean(Demanda_uni_equil))),by=list(Ruta_SAK,Cliente_ID)]\nsetnames(s_class,c(s_feat_list,\"N\",\"V1\"))\n\ns_class_test <- merge(test,s_class,by=s_feat_list,all.x=TRUE)[order(id),list(id,V1)]\nsetnames(s_class_test,c(\"id\",\"Demanda_uni_equil\"))\n\nbk = 0.45*mean(s_class_test$Demanda_uni_equil,na.rm = TRUE)\nidxna = which(is.na(s_class_test$Demanda_uni_equil))\ns_class_test[which(is.na(s_class_test$Demanda_uni_equil))] = bk\n\nestE = errMeasure(s_class_test$Demanda_uni_equil,test$Demanda_uni_equil)\nprint(estE[[1]])\nestRetE[[class_name]] = estE\nestRet[[class_name]] = s_class_test$Demanda_uni_equil\n#######################################\n\n#######################################\n# Class E:\nclass_name   = \"E\"\ns_feat_list = c(\"Agencia_ID\",\"Cliente_ID\")\ns_class <- train[,list(.N,floor(mean(Demanda_uni_equil))),by=list(Agencia_ID,Cliente_ID)]\nsetnames(s_class,c(s_feat_list,\"N\",\"V1\"))\n\ns_class_test <- merge(test,s_class,by=s_feat_list,all.x=TRUE)[order(id),list(id,V1)]\nsetnames(s_class_test,c(\"id\",\"Demanda_uni_equil\"))\n\nbk = 0.45*mean(s_class_test$Demanda_uni_equil,na.rm = TRUE)\nidxna = which(is.na(s_class_test$Demanda_uni_equil))\ns_class_test[which(is.na(s_class_test$Demanda_uni_equil))] = bk\n\nestE = errMeasure(s_class_test$Demanda_uni_equil,test$Demanda_uni_equil)\nprint(estE[[1]])\nestRetE[[class_name]] = estE\nestRet[[class_name]] = s_class_test$Demanda_uni_equil\n#######################################\n\n#######################################\n# Class F:\nclass_name   = \"F\"\ns_feat_list = c(\"Agencia_ID\",\"Cliente_ID\",\"Producto_ID\")\ns_class <- train[,list(.N,floor(mean(Demanda_uni_equil))),by=list(Agencia_ID,Cliente_ID,Producto_ID)]\nsetnames(s_class,c(s_feat_list,\"N\",\"V1\"))\n\ns_class_test <- merge(test,s_class,by=s_feat_list,all.x=TRUE)[order(id),list(id,V1)]\nsetnames(s_class_test,c(\"id\",\"Demanda_uni_equil\"))\n\nbk = 0.45*mean(s_class_test$Demanda_uni_equil,na.rm = TRUE)\nidxna = which(is.na(s_class_test$Demanda_uni_equil))\ns_class_test[which(is.na(s_class_test$Demanda_uni_equil))] = bk\n\nestE = errMeasure(s_class_test$Demanda_uni_equil,test$Demanda_uni_equil)\nprint(estE[[1]])\nestRetE[[class_name]] = estE\nestRet[[class_name]] = s_class_test$Demanda_uni_equil\n#######################################\n\n#######################################\n# Class G:\nclass_name   = \"G\"\ns_feat_list = c(\"Agencia_ID\",\"Cliente_ID\",\"Producto_ID\",\"Ruta_SAK\")\ns_class <- train[,list(.N,floor(mean(Demanda_uni_equil))),by=list(Agencia_ID,Cliente_ID,Producto_ID,Ruta_SAK)]\nsetnames(s_class,c(s_feat_list,\"N\",\"V1\"))\n\ns_class_test <- merge(test,s_class,by=s_feat_list,all.x=TRUE)[order(id),list(id,V1)]\nsetnames(s_class_test,c(\"id\",\"Demanda_uni_equil\"))\n\nbk = 0.45*mean(s_class_test$Demanda_uni_equil,na.rm = TRUE)\nidxna = which(is.na(s_class_test$Demanda_uni_equil))\ns_class_test[which(is.na(s_class_test$Demanda_uni_equil))] = bk\n\nestE = errMeasure(s_class_test$Demanda_uni_equil,test$Demanda_uni_equil)\nprint(estE[[1]])\nestRetE[[class_name]] = estE\nestRet[[class_name]] = s_class_test$Demanda_uni_equil\n#######################################\n\n# Class H:\nclass_name   = \"H\"\ns_feat_list = c(\"Agencia_ID\",\"Cliente_ID\",\"Producto_ID\",\"Ruta_SAK\",\"Canal_ID\")\ns_class <- train[,list(.N,floor(mean(Demanda_uni_equil))),by=list(Agencia_ID,Cliente_ID,Producto_ID,Canal_ID)]\nsetnames(s_class,c(s_feat_list,\"N\",\"V1\"))\n\ns_class_test <- merge(test,s_class,by=s_feat_list,all.x=TRUE)[order(id),list(id,V1)]\nsetnames(s_class_test,c(\"id\",\"Demanda_uni_equil\"))\n\nbk = 0.45*mean(s_class_test$Demanda_uni_equil,na.rm = TRUE)\nidxna = which(is.na(s_class_test$Demanda_uni_equil))\ns_class_test[which(is.na(s_class_test$Demanda_uni_equil))] = bk\n\nestE = errMeasure(s_class_test$Demanda_uni_equil,test$Demanda_uni_equil)\nprint(estE[[1]])\nestRetE[[class_name]] = estE\nestRet[[class_name]] = s_class_test$Demanda_uni_equil\n#######################################\n\n##################\n# Assembling:\nret = 0\ncoefSum = 0\ncoef = c(2.5,4,1.2,1.5,1.75,3.5,3.5,2)\nfor (i in c(1,2,3,5,6,7,8))\n{\n  #coef = 1/(0.2+(as.numeric(estRetE[[i]][1]))^4)\n  coefSum = coefSum + coef[i]\n  ret = ret + coef[i]*estRet[[i]]\n}\nret = ret/coefSum\n\nestE = errMeasure(ret,test$Demanda_uni_equil)\nprint(estE[[1]])\nfor (i in 1:length(estRetE)) print(estRetE[[i]][1])\n#################\n\n\n\n\n\n\n# Class A:\nclass_name   = \"A\"\ns_feat_list = c(\"x_100m\",\"y_100m\")\n\n#s_class <- train[,list(min(x),mean(x)-sd(x),mean(x),mean(x)+sd(x),max(x),\n#                       min(y),mean(y)-sd(y),mean(y),mean(y)+sd(y),max(x),.N),by=list(x_10m,y_10m,place_id)]\n#s_class <- train[,.N,by=list(x_10m,y_10m,place_id)]\ns_class <- train[,list(.N),by=list(x_100m,y_100m,place_id)]\ntimestamp()\ns_cluster_seq <- s_class[,top_kk(place_id,N,10),by=list(x_100m,y_100m)]\ntimestamp()\ns_cluster_score <- s_class[,top_score_kk(place_id,N,10),by=list(x_100m,y_100m)]\ntimestamp()\ns_cluster_prc <- s_class[,top_prc_kk(place_id,N,10),by=list(x_100m,y_100m)]\ntimestamp()\n\ns_id_cluster_seq <- merge(test,s_cluster_seq,by=s_feat_list,all.x=TRUE)[order(row_id),list(row_id,V1)]\nsetnames(s_id_cluster_seq,c(\"row_id\",\"cluster_seq\"))\ns_id_cluster_score <- merge(test,s_cluster_score,by=s_feat_list,all.x=TRUE)[order(row_id),list(row_id,V1)]\nsetnames(s_id_cluster_score,c(\"row_id\",\"cluster_score\"))\ns_id_cluster_prc <- merge(test,s_cluster_prc,by=s_feat_list,all.x=TRUE)[order(row_id),list(row_id,V1)]\nsetnames(s_id_cluster_prc,c(\"row_id\",\"cluster_prc\"))\n\ns_dd_seq = as.data.frame(s_id_cluster_seq)\nfName = paste(class_name,\"_s_seq.csv\",sep = \"\");write.csv(s_dd_seq, file=fName, row.names=FALSE)\ns_dd_score = as.data.frame(s_id_cluster_score)\nfName = paste(class_name,\"_s_score.csv\",sep = \"\");write.csv(s_dd_score, file=fName, row.names=FALSE)\ns_dd_prc = as.data.frame(s_id_cluster_prc)\nfName = paste(class_name,\"_s_prc.csv\",sep = \"\");write.csv(s_dd_prc, file=fName, row.names=FALSE)\n#######################################\n\n#######################################\n# Class B:\nclass_name   = \"B\"\ns_feat_list = c(\"x_100m\",\"y_10m\")\n\n#s_class <- train[,list(min(x),mean(x)-sd(x),mean(x),mean(x)+sd(x),max(x),\n#                       min(y),mean(y)-sd(y),mean(y),mean(y)+sd(y),max(x),.N),by=list(x_10m,y_10m,place_id)]\n#s_class <- train[,.N,by=list(x_10m,y_10m,place_id)]\ns_class <- train[,list(.N),by=list(x_100m,y_10m,place_id)]\ntimestamp()\ns_cluster_seq <- s_class[,top_kk(place_id,N,10),by=list(x_100m,y_10m)]\ntimestamp()\ns_cluster_score <- s_class[,top_score_kk(place_id,N,10),by=list(x_100m,y_10m)]\ntimestamp()\ns_cluster_prc <- s_class[,top_prc_kk(place_id,N,10),by=list(x_100m,y_10m)]\ntimestamp()\n\ns_id_cluster_seq <- merge(test,s_cluster_seq,by=s_feat_list,all.x=TRUE)[order(row_id),list(row_id,V1)]\nsetnames(s_id_cluster_seq,c(\"row_id\",\"cluster_seq\"))\ns_id_cluster_score <- merge(test,s_cluster_score,by=s_feat_list,all.x=TRUE)[order(row_id),list(row_id,V1)]\nsetnames(s_id_cluster_score,c(\"row_id\",\"cluster_score\"))\ns_id_cluster_prc <- merge(test,s_cluster_prc,by=s_feat_list,all.x=TRUE)[order(row_id),list(row_id,V1)]\nsetnames(s_id_cluster_prc,c(\"row_id\",\"cluster_prc\"))\n\ns_dd_seq = as.data.frame(s_id_cluster_seq)\nfName = paste(class_name,\"_s_seq.csv\",sep = \"\");write.csv(s_dd_seq, file=fName, row.names=FALSE)\ns_dd_score = as.data.frame(s_id_cluster_score)\nfName = paste(class_name,\"_s_score.csv\",sep = \"\");write.csv(s_dd_score, file=fName, row.names=FALSE)\ns_dd_prc = as.data.frame(s_id_cluster_prc)\nfName = paste(class_name,\"_s_prc.csv\",sep = \"\");write.csv(s_dd_prc, file=fName, row.names=FALSE)\n#######################################\n\n#######################################\n# Class C:\nclass_name   = \"C\"\ns_feat_list = c(\"x_km\",\"y_km\")\n\n#s_class <- train[,list(min(x),mean(x)-sd(x),mean(x),mean(x)+sd(x),max(x),\n#                       min(y),mean(y)-sd(y),mean(y),mean(y)+sd(y),max(x),.N),by=list(x_10m,y_10m,place_id)]\n#s_class <- train[,.N,by=list(x_10m,y_10m,place_id)]\ns_class <- train[,list(.N),by=list(x_km,y_km,place_id)]\ntimestamp()\ns_cluster_seq <- s_class[,top_kk(place_id,N,10),by=list(x_km,y_km)]\ntimestamp()\ns_cluster_score <- s_class[,top_score_kk(place_id,N,10),by=list(x_km,y_km)]\ntimestamp()\ns_cluster_prc <- s_class[,top_prc_kk(place_id,N,10),by=list(x_km,y_km)]\ntimestamp()\n\ns_id_cluster_seq <- merge(test,s_cluster_seq,by=s_feat_list,all.x=TRUE)[order(row_id),list(row_id,V1)]\nsetnames(s_id_cluster_seq,c(\"row_id\",\"cluster_seq\"))\ns_id_cluster_score <- merge(test,s_cluster_score,by=s_feat_list,all.x=TRUE)[order(row_id),list(row_id,V1)]\nsetnames(s_id_cluster_score,c(\"row_id\",\"cluster_score\"))\ns_id_cluster_prc <- merge(test,s_cluster_prc,by=s_feat_list,all.x=TRUE)[order(row_id),list(row_id,V1)]\nsetnames(s_id_cluster_prc,c(\"row_id\",\"cluster_prc\"))\n\ns_dd_seq = as.data.frame(s_id_cluster_seq)\nfName = paste(class_name,\"_s_seq.csv\",sep = \"\");write.csv(s_dd_seq, file=fName, row.names=FALSE)\ns_dd_score = as.data.frame(s_id_cluster_score)\nfName = paste(class_name,\"_s_score.csv\",sep = \"\");write.csv(s_dd_score, file=fName, row.names=FALSE)\ns_dd_prc = as.data.frame(s_id_cluster_prc)\nfName = paste(class_name,\"_s_prc.csv\",sep = \"\");write.csv(s_dd_prc, file=fName, row.names=FALSE)\n#######################################\n\n#######################################\n# Class D:\nclass_name   = \"D\"\ns_feat_list = c(\"x_10m\",\"y_10m\")\n\n#s_class <- train[,list(min(x),mean(x)-sd(x),mean(x),mean(x)+sd(x),max(x),\n#                       min(y),mean(y)-sd(y),mean(y),mean(y)+sd(y),max(x),.N),by=list(x_10m,y_10m,place_id)]\n#s_class <- train[,.N,by=list(x_10m,y_10m,place_id)]\ns_class <- train[,list(.N),by=list(x_10m,y_10m,place_id)]\ntimestamp()\ns_cluster_seq <- s_class[,top_kk(place_id,N,10),by=list(x_10m,y_10m)]\ntimestamp()\ns_cluster_score <- s_class[,top_score_kk(place_id,N,10),by=list(x_10m,y_10m)]\ntimestamp()\ns_cluster_prc <- s_class[,top_prc_kk(place_id,N,10),by=list(x_10m,y_10m)]\ntimestamp()\n\ns_id_cluster_seq <- merge(test,s_cluster_seq,by=s_feat_list,all.x=TRUE)[order(row_id),list(row_id,V1)]\nsetnames(s_id_cluster_seq,c(\"row_id\",\"cluster_seq\"))\ns_id_cluster_score <- merge(test,s_cluster_score,by=s_feat_list,all.x=TRUE)[order(row_id),list(row_id,V1)]\nsetnames(s_id_cluster_score,c(\"row_id\",\"cluster_score\"))\ns_id_cluster_prc <- merge(test,s_cluster_prc,by=s_feat_list,all.x=TRUE)[order(row_id),list(row_id,V1)]\nsetnames(s_id_cluster_prc,c(\"row_id\",\"cluster_prc\"))\n\ns_dd_seq = as.data.frame(s_id_cluster_seq)\nfName = paste(class_name,\"_s_seq.csv\",sep = \"\");write.csv(s_dd_seq, file=fName, row.names=FALSE)\ns_dd_score = as.data.frame(s_id_cluster_score)\nfName = paste(class_name,\"_s_score.csv\",sep = \"\");write.csv(s_dd_score, file=fName, row.names=FALSE)\ns_dd_prc = as.data.frame(s_id_cluster_prc)\nfName = paste(class_name,\"_s_prc.csv\",sep = \"\");write.csv(s_dd_prc, file=fName, row.names=FALSE)\n#######################################\n\n#######################################\n# Class E:\nclass_name   = \"E\"\ns_feat_list = c(\"x_20m\",\"y_5m\")\n\ns_class <- train[,list(.N),by=list(x_20m,y_5m,place_id)]\ntimestamp()\ns_cluster_seq <- s_class[,top_kk(place_id,N,10),by=list(x_20m,y_5m)]\ntimestamp()\ns_cluster_score <- s_class[,top_score_kk(place_id,N,10),by=list(x_20m,y_5m)]\ntimestamp()\ns_cluster_prc <- s_class[,top_prc_kk(place_id,N,10),by=list(x_20m,y_5m)]\ntimestamp()\n\ns_id_cluster_seq <- merge(test,s_cluster_seq,by=s_feat_list,all.x=TRUE)[order(row_id),list(row_id,V1)]\nsetnames(s_id_cluster_seq,c(\"row_id\",\"cluster_seq\"))\ns_id_cluster_score <- merge(test,s_cluster_score,by=s_feat_list,all.x=TRUE)[order(row_id),list(row_id,V1)]\nsetnames(s_id_cluster_score,c(\"row_id\",\"cluster_score\"))\ns_id_cluster_prc <- merge(test,s_cluster_prc,by=s_feat_list,all.x=TRUE)[order(row_id),list(row_id,V1)]\nsetnames(s_id_cluster_prc,c(\"row_id\",\"cluster_prc\"))\n\ns_dd_seq = as.data.frame(s_id_cluster_seq)\nfName = paste(class_name,\"_s_seq.csv\",sep = \"\");write.csv(s_dd_seq, file=fName, row.names=FALSE)\ns_dd_score = as.data.frame(s_id_cluster_score)\nfName = paste(class_name,\"_s_score.csv\",sep = \"\");write.csv(s_dd_score, file=fName, row.names=FALSE)\ns_dd_prc = as.data.frame(s_id_cluster_prc)\nfName = paste(class_name,\"_s_prc.csv\",sep = \"\");write.csv(s_dd_prc, file=fName, row.names=FALSE)\n#######################################\n\n#######################################\n# Class F:\nclass_name   = \"F\"\ns_feat_list = c(\"x_5m\",\"y_20m\")\n\ns_class <- train[,list(.N),by=list(x_5m,y_20m,place_id)]\ntimestamp()\ns_cluster_seq <- s_class[,top_kk(place_id,N,10),by=list(x_5m,y_20m)]\ntimestamp()\ns_cluster_score <- s_class[,top_score_kk(place_id,N,10),by=list(x_5m,y_20m)]\ntimestamp()\ns_cluster_prc <- s_class[,top_prc_kk(place_id,N,10),by=list(x_5m,y_20m)]\ntimestamp()\n\ns_id_cluster_seq <- merge(test,s_cluster_seq,by=s_feat_list,all.x=TRUE)[order(row_id),list(row_id,V1)]\nsetnames(s_id_cluster_seq,c(\"row_id\",\"cluster_seq\"))\ns_id_cluster_score <- merge(test,s_cluster_score,by=s_feat_list,all.x=TRUE)[order(row_id),list(row_id,V1)]\nsetnames(s_id_cluster_score,c(\"row_id\",\"cluster_score\"))\ns_id_cluster_prc <- merge(test,s_cluster_prc,by=s_feat_list,all.x=TRUE)[order(row_id),list(row_id,V1)]\nsetnames(s_id_cluster_prc,c(\"row_id\",\"cluster_prc\"))\n\ns_dd_seq = as.data.frame(s_id_cluster_seq)\nfName = paste(class_name,\"_s_seq.csv\",sep = \"\");write.csv(s_dd_seq, file=fName, row.names=FALSE)\ns_dd_score = as.data.frame(s_id_cluster_score)\nfName = paste(class_name,\"_s_score.csv\",sep = \"\");write.csv(s_dd_score, file=fName, row.names=FALSE)\ns_dd_prc = as.data.frame(s_id_cluster_prc)\nfName = paste(class_name,\"_s_prc.csv\",sep = \"\");write.csv(s_dd_prc, file=fName, row.names=FALSE)\n#######################################\n\n#######################################\n# Class G:\nclass_name   = \"G\"\ns_feat_list = c(\"x_20m\",\"y_5m\",\"hour\")\n\ns_class <- train[,list(.N),by=list(x_20m,y_5m,hour,place_id)]\ntimestamp()\ns_cluster_seq <- s_class[,top_kk(place_id,N,10),by=list(x_20m,y_5m,hour)]\ntimestamp()\ns_cluster_score <- s_class[,top_score_kk(place_id,N,10),by=list(x_20m,y_5m,hour)]\ntimestamp()\ns_cluster_prc <- s_class[,top_prc_kk(place_id,N,10),by=list(x_20m,y_5m,hour)]\ntimestamp()\n\ns_id_cluster_seq <- merge(test,s_cluster_seq,by=s_feat_list,all.x=TRUE)[order(row_id),list(row_id,V1)]\nsetnames(s_id_cluster_seq,c(\"row_id\",\"cluster_seq\"))\ns_id_cluster_score <- merge(test,s_cluster_score,by=s_feat_list,all.x=TRUE)[order(row_id),list(row_id,V1)]\nsetnames(s_id_cluster_score,c(\"row_id\",\"cluster_score\"))\ns_id_cluster_prc <- merge(test,s_cluster_prc,by=s_feat_list,all.x=TRUE)[order(row_id),list(row_id,V1)]\nsetnames(s_id_cluster_prc,c(\"row_id\",\"cluster_prc\"))\n\ns_dd_seq = as.data.frame(s_id_cluster_seq)\nfName = paste(class_name,\"_s_seq.csv\",sep = \"\");write.csv(s_dd_seq, file=fName, row.names=FALSE)\ns_dd_score = as.data.frame(s_id_cluster_score)\nfName = paste(class_name,\"_s_score.csv\",sep = \"\");write.csv(s_dd_score, file=fName, row.names=FALSE)\ns_dd_prc = as.data.frame(s_id_cluster_prc)\nfName = paste(class_name,\"_s_prc.csv\",sep = \"\");write.csv(s_dd_prc, file=fName, row.names=FALSE)\n#######################################\n\n#######################################\n# Class H:\nclass_name   = \"H\"\ns_feat_list = c(\"x_5m\",\"y_20m\",\"hour\")\n\ns_class <- train[,list(.N),by=list(x_5m,y_20m,hour,place_id)]\ntimestamp()\ns_cluster_seq <- s_class[,top_kk(place_id,N,10),by=list(x_5m,y_20m,hour)]\ntimestamp()\ns_cluster_score <- s_class[,top_score_kk(place_id,N,10),by=list(x_5m,y_20m,hour)]\ntimestamp()\ns_cluster_prc <- s_class[,top_prc_kk(place_id,N,10),by=list(x_5m,y_20m,hour)]\ntimestamp()\n\ns_id_cluster_seq <- merge(test,s_cluster_seq,by=s_feat_list,all.x=TRUE)[order(row_id),list(row_id,V1)]\nsetnames(s_id_cluster_seq,c(\"row_id\",\"cluster_seq\"))\ns_id_cluster_score <- merge(test,s_cluster_score,by=s_feat_list,all.x=TRUE)[order(row_id),list(row_id,V1)]\nsetnames(s_id_cluster_score,c(\"row_id\",\"cluster_score\"))\ns_id_cluster_prc <- merge(test,s_cluster_prc,by=s_feat_list,all.x=TRUE)[order(row_id),list(row_id,V1)]\nsetnames(s_id_cluster_prc,c(\"row_id\",\"cluster_prc\"))\n\ns_dd_seq = as.data.frame(s_id_cluster_seq)\nfName = paste(class_name,\"_s_seq.csv\",sep = \"\");write.csv(s_dd_seq, file=fName, row.names=FALSE)\ns_dd_score = as.data.frame(s_id_cluster_score)\nfName = paste(class_name,\"_s_score.csv\",sep = \"\");write.csv(s_dd_score, file=fName, row.names=FALSE)\ns_dd_prc = as.data.frame(s_id_cluster_prc)\nfName = paste(class_name,\"_s_prc.csv\",sep = \"\");write.csv(s_dd_prc, file=fName, row.names=FALSE)\n#######################################\n\n#######################################\n# Class I:\nclass_name   = \"I\"\ns_feat_list = c(\"x_20m\",\"y_5m\",\"hour\",\"weekday\")\n\ns_class <- train[,list(.N),by=list(x_20m,y_5m,hour,weekday,place_id)]\ntimestamp()\ns_cluster_seq <- s_class[,top_kk(place_id,N,10),by=list(x_20m,y_5m,hour,weekday)]\ntimestamp()\ns_cluster_score <- s_class[,top_score_kk(place_id,N,10),by=list(x_20m,y_5m,hour,weekday)]\ntimestamp()\ns_cluster_prc <- s_class[,top_prc_kk(place_id,N,10),by=list(x_20m,y_5m,hour,weekday)]\ntimestamp()\n\ns_id_cluster_seq <- merge(test,s_cluster_seq,by=s_feat_list,all.x=TRUE)[order(row_id),list(row_id,V1)]\nsetnames(s_id_cluster_seq,c(\"row_id\",\"cluster_seq\"))\ns_id_cluster_score <- merge(test,s_cluster_score,by=s_feat_list,all.x=TRUE)[order(row_id),list(row_id,V1)]\nsetnames(s_id_cluster_score,c(\"row_id\",\"cluster_score\"))\ns_id_cluster_prc <- merge(test,s_cluster_prc,by=s_feat_list,all.x=TRUE)[order(row_id),list(row_id,V1)]\nsetnames(s_id_cluster_prc,c(\"row_id\",\"cluster_prc\"))\n\ns_dd_seq = as.data.frame(s_id_cluster_seq)\nfName = paste(class_name,\"_s_seq.csv\",sep = \"\");write.csv(s_dd_seq, file=fName, row.names=FALSE)\ns_dd_score = as.data.frame(s_id_cluster_score)\nfName = paste(class_name,\"_s_score.csv\",sep = \"\");write.csv(s_dd_score, file=fName, row.names=FALSE)\ns_dd_prc = as.data.frame(s_id_cluster_prc)\nfName = paste(class_name,\"_s_prc.csv\",sep = \"\");write.csv(s_dd_prc, file=fName, row.names=FALSE)\n#######################################\n\n#######################################\n# Class J:\nclass_name   = \"J\"\ns_feat_list = c(\"x_5m\",\"y_20m\",\"hour\",\"weekday\")\n\ns_class <- train[,list(.N),by=list(x_5m,y_20m,hour,weekday,place_id)]\ntimestamp()\ns_cluster_seq <- s_class[,top_kk(place_id,N,10),by=list(x_5m,y_20m,hour,weekday)]\ntimestamp()\ns_cluster_score <- s_class[,top_score_kk(place_id,N,10),by=list(x_5m,y_20m,hour,weekday)]\ntimestamp()\ns_cluster_prc <- s_class[,top_prc_kk(place_id,N,10),by=list(x_5m,y_20m,hour,weekday)]\ntimestamp()\n\ns_id_cluster_seq <- merge(test,s_cluster_seq,by=s_feat_list,all.x=TRUE)[order(row_id),list(row_id,V1)]\nsetnames(s_id_cluster_seq,c(\"row_id\",\"cluster_seq\"))\ns_id_cluster_score <- merge(test,s_cluster_score,by=s_feat_list,all.x=TRUE)[order(row_id),list(row_id,V1)]\nsetnames(s_id_cluster_score,c(\"row_id\",\"cluster_score\"))\ns_id_cluster_prc <- merge(test,s_cluster_prc,by=s_feat_list,all.x=TRUE)[order(row_id),list(row_id,V1)]\nsetnames(s_id_cluster_prc,c(\"row_id\",\"cluster_prc\"))\n\ns_dd_seq = as.data.frame(s_id_cluster_seq)\nfName = paste(class_name,\"_s_seq.csv\",sep = \"\");write.csv(s_dd_seq, file=fName, row.names=FALSE)\ns_dd_score = as.data.frame(s_id_cluster_score)\nfName = paste(class_name,\"_s_score.csv\",sep = \"\");write.csv(s_dd_score, file=fName, row.names=FALSE)\ns_dd_prc = as.data.frame(s_id_cluster_prc)\nfName = paste(class_name,\"_s_prc.csv\",sep = \"\");write.csv(s_dd_prc, file=fName, row.names=FALSE)\n#######################################\n\n#######################################\n# Class K:\nclass_name   = \"K\"\ns_feat_list = c(\"x_20m\",\"y_5m\")\n\ns_class <- train[,mean(logac),by=list(x_20m,y_5m,place_id)]\ntimestamp()\ns_cluster_seq <- s_class[,top_kk(place_id,V1,10),by=list(x_20m,y_5m)]\ntimestamp()\ns_cluster_score <- s_class[,top_score_kk(place_id,V1,10),by=list(x_20m,y_5m)]\ntimestamp()\ns_cluster_prc <- s_class[,top_prc_kk(place_id,V1,10),by=list(x_20m,y_5m)]\ntimestamp()\n\ns_id_cluster_seq <- merge(test,s_cluster_seq,by=s_feat_list,all.x=TRUE)[order(row_id),list(row_id,V1)]\nsetnames(s_id_cluster_seq,c(\"row_id\",\"cluster_seq\"))\ns_id_cluster_score <- merge(test,s_cluster_score,by=s_feat_list,all.x=TRUE)[order(row_id),list(row_id,V1)]\nsetnames(s_id_cluster_score,c(\"row_id\",\"cluster_score\"))\ns_id_cluster_prc <- merge(test,s_cluster_prc,by=s_feat_list,all.x=TRUE)[order(row_id),list(row_id,V1)]\nsetnames(s_id_cluster_prc,c(\"row_id\",\"cluster_prc\"))\n\ns_dd_seq = as.data.frame(s_id_cluster_seq)\nfName = paste(class_name,\"_s_seq.csv\",sep = \"\");write.csv(s_dd_seq, file=fName, row.names=FALSE)\ns_dd_score = as.data.frame(s_id_cluster_score)\nfName = paste(class_name,\"_s_score.csv\",sep = \"\");write.csv(s_dd_score, file=fName, row.names=FALSE)\ns_dd_prc = as.data.frame(s_id_cluster_prc)\nfName = paste(class_name,\"_s_prc.csv\",sep = \"\");write.csv(s_dd_prc, file=fName, row.names=FALSE)\n#######################################\n\n#######################################\n# Class L:\nclass_name   = \"L\"\ns_feat_list = c(\"x_5m\",\"y_20m\")\n\ns_class <- train[,mean(logac),by=list(x_5m,y_20m,place_id)]\ntimestamp()\ns_cluster_seq <- s_class[,top_kk(place_id,V1,10),by=list(x_5m,y_20m)]\ntimestamp()\ns_cluster_score <- s_class[,top_score_kk(place_id,V1,10),by=list(x_5m,y_20m)]\ntimestamp()\ns_cluster_prc <- s_class[,top_prc_kk(place_id,V1,10),by=list(x_5m,y_20m)]\ntimestamp()\n\ns_id_cluster_seq <- merge(test,s_cluster_seq,by=s_feat_list,all.x=TRUE)[order(row_id),list(row_id,V1)]\nsetnames(s_id_cluster_seq,c(\"row_id\",\"cluster_seq\"))\ns_id_cluster_score <- merge(test,s_cluster_score,by=s_feat_list,all.x=TRUE)[order(row_id),list(row_id,V1)]\nsetnames(s_id_cluster_score,c(\"row_id\",\"cluster_score\"))\ns_id_cluster_prc <- merge(test,s_cluster_prc,by=s_feat_list,all.x=TRUE)[order(row_id),list(row_id,V1)]\nsetnames(s_id_cluster_prc,c(\"row_id\",\"cluster_prc\"))\n\ns_dd_seq = as.data.frame(s_id_cluster_seq)\nfName = paste(class_name,\"_s_seq.csv\",sep = \"\");write.csv(s_dd_seq, file=fName, row.names=FALSE)\ns_dd_score = as.data.frame(s_id_cluster_score)\nfName = paste(class_name,\"_s_score.csv\",sep = \"\");write.csv(s_dd_score, file=fName, row.names=FALSE)\ns_dd_prc = as.data.frame(s_id_cluster_prc)\nfName = paste(class_name,\"_s_prc.csv\",sep = \"\");write.csv(s_dd_prc, file=fName, row.names=FALSE)\n#######################################\n\n#######################################\n# Class M:\nclass_name   = \"M\"\ns_feat_list = c(\"x_20m\",\"y_5m\")\n\ntrain_place_id_count = train[,.N,by=list(place_id)]\nsetnames(train_place_id_count,c(\"place_id\",\"countN\"))\ns_class <- train[,.N,by=list(x_20m,y_5m,place_id)]\ns_class <- merge(s_class,train_place_id_count,by=\"place_id\")\ns_class$prcN <- s_class$N/s_class$countN\ntimestamp()\ns_cluster_seq <- s_class[,top_kk(place_id,prcN,10),by=list(x_20m,y_5m)]\ntimestamp()\ns_cluster_score <- s_class[,top_score_kk(place_id,prcN,10),by=list(x_20m,y_5m)]\ntimestamp()\ns_cluster_prc <- s_class[,top_prc_kk(place_id,prcN,10),by=list(x_20m,y_5m)]\ntimestamp()\n\ns_id_cluster_seq <- merge(test,s_cluster_seq,by=s_feat_list,all.x=TRUE)[order(row_id),list(row_id,V1)]\nsetnames(s_id_cluster_seq,c(\"row_id\",\"cluster_seq\"))\ns_id_cluster_score <- merge(test,s_cluster_score,by=s_feat_list,all.x=TRUE)[order(row_id),list(row_id,V1)]\nsetnames(s_id_cluster_score,c(\"row_id\",\"cluster_score\"))\ns_id_cluster_prc <- merge(test,s_cluster_prc,by=s_feat_list,all.x=TRUE)[order(row_id),list(row_id,V1)]\nsetnames(s_id_cluster_prc,c(\"row_id\",\"cluster_prc\"))\n\ns_dd_seq = as.data.frame(s_id_cluster_seq)\nfName = paste(class_name,\"_s_seq.csv\",sep = \"\");write.csv(s_dd_seq, file=fName, row.names=FALSE)\ns_dd_score = as.data.frame(s_id_cluster_score)\nfName = paste(class_name,\"_s_score.csv\",sep = \"\");write.csv(s_dd_score, file=fName, row.names=FALSE)\ns_dd_prc = as.data.frame(s_id_cluster_prc)\nfName = paste(class_name,\"_s_prc.csv\",sep = \"\");write.csv(s_dd_prc, file=fName, row.names=FALSE)\n#######################################\n\n#######################################\n# Class N:\nclass_name   = \"N\"\ns_feat_list = c(\"x_5m\",\"y_20m\")\n\ntrain_place_id_count = train[,.N,by=list(place_id)]\nsetnames(train_place_id_count,c(\"place_id\",\"countN\"))\ns_class <- train[,.N,by=list(x_5m,y_20m,place_id)]\ns_class <- merge(s_class,train_place_id_count,by=\"place_id\")\ns_class$prcN <- s_class$N/s_class$countN\ntimestamp()\ns_cluster_seq <- s_class[,top_kk(place_id,prcN,10),by=list(x_5m,y_20m)]\ntimestamp()\ns_cluster_score <- s_class[,top_score_kk(place_id,prcN,10),by=list(x_5m,y_20m)]\ntimestamp()\ns_cluster_prc <- s_class[,top_prc_kk(place_id,prcN,10),by=list(x_5m,y_20m)]\ntimestamp()\n\ns_id_cluster_seq <- merge(test,s_cluster_seq,by=s_feat_list,all.x=TRUE)[order(row_id),list(row_id,V1)]\nsetnames(s_id_cluster_seq,c(\"row_id\",\"cluster_seq\"))\ns_id_cluster_score <- merge(test,s_cluster_score,by=s_feat_list,all.x=TRUE)[order(row_id),list(row_id,V1)]\nsetnames(s_id_cluster_score,c(\"row_id\",\"cluster_score\"))\ns_id_cluster_prc <- merge(test,s_cluster_prc,by=s_feat_list,all.x=TRUE)[order(row_id),list(row_id,V1)]\nsetnames(s_id_cluster_prc,c(\"row_id\",\"cluster_prc\"))\n\ns_dd_seq = as.data.frame(s_id_cluster_seq)\nfName = paste(class_name,\"_s_seq.csv\",sep = \"\");write.csv(s_dd_seq, file=fName, row.names=FALSE)\ns_dd_score = as.data.frame(s_id_cluster_score)\nfName = paste(class_name,\"_s_score.csv\",sep = \"\");write.csv(s_dd_score, file=fName, row.names=FALSE)\ns_dd_prc = as.data.frame(s_id_cluster_prc)\nfName = paste(class_name,\"_s_prc.csv\",sep = \"\");write.csv(s_dd_prc, file=fName, row.names=FALSE)\n#######################################\n\n#######################################\n# Class Q:\nclass_name   = \"Q\"\ns_feat_list = c(\"x_5m\",\"y_5m\")\n\n#s_class <- train[,list(min(x),mean(x)-sd(x),mean(x),mean(x)+sd(x),max(x),\n#                       min(y),mean(y)-sd(y),mean(y),mean(y)+sd(y),max(x),.N),by=list(x_10m,y_10m,place_id)]\n#s_class <- train[,.N,by=list(x_10m,y_10m,place_id)]\ns_class <- train[,list(.N),by=list(x_5m,y_5m,place_id)]\ntimestamp()\ns_cluster_seq <- s_class[,top_kk(place_id,N,10),by=list(x_5m,y_5m)]\ntimestamp()\ns_cluster_score <- s_class[,top_score_kk(place_id,N,10),by=list(x_5m,y_5m)]\ntimestamp()\ns_cluster_prc <- s_class[,top_prc_kk(place_id,N,10),by=list(x_5m,y_5m)]\ntimestamp()\n\ns_id_cluster_seq <- merge(test,s_cluster_seq,by=s_feat_list,all.x=TRUE)[order(row_id),list(row_id,V1)]\nsetnames(s_id_cluster_seq,c(\"row_id\",\"cluster_seq\"))\ns_id_cluster_score <- merge(test,s_cluster_score,by=s_feat_list,all.x=TRUE)[order(row_id),list(row_id,V1)]\nsetnames(s_id_cluster_score,c(\"row_id\",\"cluster_score\"))\ns_id_cluster_prc <- merge(test,s_cluster_prc,by=s_feat_list,all.x=TRUE)[order(row_id),list(row_id,V1)]\nsetnames(s_id_cluster_prc,c(\"row_id\",\"cluster_prc\"))\n\ns_dd_seq = as.data.frame(s_id_cluster_seq)\nfName = paste(class_name,\"_s_seq.csv\",sep = \"\");write.csv(s_dd_seq, file=fName, row.names=FALSE)\ns_dd_score = as.data.frame(s_id_cluster_score)\nfName = paste(class_name,\"_s_score.csv\",sep = \"\");write.csv(s_dd_score, file=fName, row.names=FALSE)\ns_dd_prc = as.data.frame(s_id_cluster_prc)\nfName = paste(class_name,\"_s_prc.csv\",sep = \"\");write.csv(s_dd_prc, file=fName, row.names=FALSE)\n#######################################\n\n#######################################\n# Class R:\nclass_name   = \"R\"\ns_feat_list = c(\"x_20m\",\"y_20m\")\n\ns_class <- train[,list(.N),by=list(x_20m,y_20m,place_id)]\ntimestamp()\ns_cluster_seq <- s_class[,top_kk(place_id,N,10),by=list(x_20m,y_20m)]\ntimestamp()\ns_cluster_score <- s_class[,top_score_kk(place_id,N,10),by=list(x_20m,y_20m)]\ntimestamp()\ns_cluster_prc <- s_class[,top_prc_kk(place_id,N,10),by=list(x_20m,y_20m)]\ntimestamp()\n\ns_id_cluster_seq <- merge(test,s_cluster_seq,by=s_feat_list,all.x=TRUE)[order(row_id),list(row_id,V1)]\nsetnames(s_id_cluster_seq,c(\"row_id\",\"cluster_seq\"))\ns_id_cluster_score <- merge(test,s_cluster_score,by=s_feat_list,all.x=TRUE)[order(row_id),list(row_id,V1)]\nsetnames(s_id_cluster_score,c(\"row_id\",\"cluster_score\"))\ns_id_cluster_prc <- merge(test,s_cluster_prc,by=s_feat_list,all.x=TRUE)[order(row_id),list(row_id,V1)]\nsetnames(s_id_cluster_prc,c(\"row_id\",\"cluster_prc\"))\n\ns_dd_seq = as.data.frame(s_id_cluster_seq)\nfName = paste(class_name,\"_s_seq.csv\",sep = \"\");write.csv(s_dd_seq, file=fName, row.names=FALSE)\ns_dd_score = as.data.frame(s_id_cluster_score)\nfName = paste(class_name,\"_s_score.csv\",sep = \"\");write.csv(s_dd_score, file=fName, row.names=FALSE)\ns_dd_prc = as.data.frame(s_id_cluster_prc)\nfName = paste(class_name,\"_s_prc.csv\",sep = \"\");write.csv(s_dd_prc, file=fName, row.names=FALSE)\n#######################################\n\n#######################################\n# Class S:\nclass_name   = \"S\"\ns_feat_list = c(\"x_20m\",\"y_1m\")\n\ns_class <- train[,list(.N),by=list(x_20m,y_1m,place_id)]\ntimestamp()\ns_cluster_seq <- s_class[,top_kk(place_id,N,10),by=list(x_20m,y_1m)]\ntimestamp()\ns_cluster_score <- s_class[,top_score_kk(place_id,N,10),by=list(x_20m,y_1m)]\ntimestamp()\ns_cluster_prc <- s_class[,top_prc_kk(place_id,N,10),by=list(x_20m,y_1m)]\ntimestamp()\n\ns_id_cluster_seq <- merge(test,s_cluster_seq,by=s_feat_list,all.x=TRUE)[order(row_id),list(row_id,V1)]\nsetnames(s_id_cluster_seq,c(\"row_id\",\"cluster_seq\"))\ns_id_cluster_score <- merge(test,s_cluster_score,by=s_feat_list,all.x=TRUE)[order(row_id),list(row_id,V1)]\nsetnames(s_id_cluster_score,c(\"row_id\",\"cluster_score\"))\ns_id_cluster_prc <- merge(test,s_cluster_prc,by=s_feat_list,all.x=TRUE)[order(row_id),list(row_id,V1)]\nsetnames(s_id_cluster_prc,c(\"row_id\",\"cluster_prc\"))\n\ns_dd_seq = as.data.frame(s_id_cluster_seq)\nfName = paste(class_name,\"_s_seq.csv\",sep = \"\");write.csv(s_dd_seq, file=fName, row.names=FALSE)\ns_dd_score = as.data.frame(s_id_cluster_score)\nfName = paste(class_name,\"_s_score.csv\",sep = \"\");write.csv(s_dd_score, file=fName, row.names=FALSE)\ns_dd_prc = as.data.frame(s_id_cluster_prc)\nfName = paste(class_name,\"_s_prc.csv\",sep = \"\");write.csv(s_dd_prc, file=fName, row.names=FALSE)\n#######################################\n\n#######################################\n# Class T:\nclass_name   = \"T\"\ns_feat_list = c(\"x_1m\",\"y_20m\")\n\ns_class <- train[,list(.N),by=list(x_1m,y_20m,place_id)]\ntimestamp()\ns_cluster_seq <- s_class[,top_kk(place_id,N,10),by=list(x_1m,y_20m)]\ntimestamp()\ns_cluster_score <- s_class[,top_score_kk(place_id,N,10),by=list(x_1m,y_20m)]\ntimestamp()\ns_cluster_prc <- s_class[,top_prc_kk(place_id,N,10),by=list(x_1m,y_20m)]\ntimestamp()\n\ns_id_cluster_seq <- merge(test,s_cluster_seq,by=s_feat_list,all.x=TRUE)[order(row_id),list(row_id,V1)]\nsetnames(s_id_cluster_seq,c(\"row_id\",\"cluster_seq\"))\ns_id_cluster_score <- merge(test,s_cluster_score,by=s_feat_list,all.x=TRUE)[order(row_id),list(row_id,V1)]\nsetnames(s_id_cluster_score,c(\"row_id\",\"cluster_score\"))\ns_id_cluster_prc <- merge(test,s_cluster_prc,by=s_feat_list,all.x=TRUE)[order(row_id),list(row_id,V1)]\nsetnames(s_id_cluster_prc,c(\"row_id\",\"cluster_prc\"))\n\ns_dd_seq = as.data.frame(s_id_cluster_seq)\nfName = paste(class_name,\"_s_seq.csv\",sep = \"\");write.csv(s_dd_seq, file=fName, row.names=FALSE)\ns_dd_score = as.data.frame(s_id_cluster_score)\nfName = paste(class_name,\"_s_score.csv\",sep = \"\");write.csv(s_dd_score, file=fName, row.names=FALSE)\ns_dd_prc = as.data.frame(s_id_cluster_prc)\nfName = paste(class_name,\"_s_prc.csv\",sep = \"\");write.csv(s_dd_prc, file=fName, row.names=FALSE)\n#######################################\n\n#######################################\n# Class U:\nclass_name   = \"U\"\ns_feat_list = c(\"x_20m\",\"y_5m\",\"hr3\")\n\ns_class <- train[,list(.N),by=list(x_20m,y_5m,hr3,place_id)]\ntimestamp()\ns_cluster_seq <- s_class[,top_kk(place_id,N,10),by=list(x_20m,y_5m,hr3)]\ntimestamp()\ns_cluster_score <- s_class[,top_score_kk(place_id,N,10),by=list(x_20m,y_5m,hr3)]\ntimestamp()\ns_cluster_prc <- s_class[,top_prc_kk(place_id,N,10),by=list(x_20m,y_5m,hr3)]\ntimestamp()\n\ns_id_cluster_seq <- merge(test,s_cluster_seq,by=s_feat_list,all.x=TRUE)[order(row_id),list(row_id,V1)]\nsetnames(s_id_cluster_seq,c(\"row_id\",\"cluster_seq\"))\ns_id_cluster_score <- merge(test,s_cluster_score,by=s_feat_list,all.x=TRUE)[order(row_id),list(row_id,V1)]\nsetnames(s_id_cluster_score,c(\"row_id\",\"cluster_score\"))\ns_id_cluster_prc <- merge(test,s_cluster_prc,by=s_feat_list,all.x=TRUE)[order(row_id),list(row_id,V1)]\nsetnames(s_id_cluster_prc,c(\"row_id\",\"cluster_prc\"))\n\ns_dd_seq = as.data.frame(s_id_cluster_seq)\nfName = paste(class_name,\"_s_seq.csv\",sep = \"\");write.csv(s_dd_seq, file=fName, row.names=FALSE)\ns_dd_score = as.data.frame(s_id_cluster_score)\nfName = paste(class_name,\"_s_score.csv\",sep = \"\");write.csv(s_dd_score, file=fName, row.names=FALSE)\ns_dd_prc = as.data.frame(s_id_cluster_prc)\nfName = paste(class_name,\"_s_prc.csv\",sep = \"\");write.csv(s_dd_prc, file=fName, row.names=FALSE)\n#######################################\n\n#######################################\n# Class V:\nclass_name   = \"V\"\ns_feat_list = c(\"x_5m\",\"y_20m\",\"hr3\")\n\ns_class <- train[,list(.N),by=list(x_5m,y_20m,hr3,place_id)]\ntimestamp()\ns_cluster_seq <- s_class[,top_kk(place_id,N,10),by=list(x_5m,y_20m,hr3)]\ntimestamp()\ns_cluster_score <- s_class[,top_score_kk(place_id,N,10),by=list(x_5m,y_20m,hr3)]\ntimestamp()\ns_cluster_prc <- s_class[,top_prc_kk(place_id,N,10),by=list(x_5m,y_20m,hr3)]\ntimestamp()\n\ns_id_cluster_seq <- merge(test,s_cluster_seq,by=s_feat_list,all.x=TRUE)[order(row_id),list(row_id,V1)]\nsetnames(s_id_cluster_seq,c(\"row_id\",\"cluster_seq\"))\ns_id_cluster_score <- merge(test,s_cluster_score,by=s_feat_list,all.x=TRUE)[order(row_id),list(row_id,V1)]\nsetnames(s_id_cluster_score,c(\"row_id\",\"cluster_score\"))\ns_id_cluster_prc <- merge(test,s_cluster_prc,by=s_feat_list,all.x=TRUE)[order(row_id),list(row_id,V1)]\nsetnames(s_id_cluster_prc,c(\"row_id\",\"cluster_prc\"))\n\ns_dd_seq = as.data.frame(s_id_cluster_seq)\nfName = paste(class_name,\"_s_seq.csv\",sep = \"\");write.csv(s_dd_seq, file=fName, row.names=FALSE)\ns_dd_score = as.data.frame(s_id_cluster_score)\nfName = paste(class_name,\"_s_score.csv\",sep = \"\");write.csv(s_dd_score, file=fName, row.names=FALSE)\ns_dd_prc = as.data.frame(s_id_cluster_prc)\nfName = paste(class_name,\"_s_prc.csv\",sep = \"\");write.csv(s_dd_prc, file=fName, row.names=FALSE)\n#######################################\n\n\n#######################################\n# Class X:\nclass_name   = \"X\"\ns_feat_list = c(\"x_100m\",\"y_10m\",\"hr3\")\n\ns_class <- train[,list(.N),by=list(x_100m,y_10m,hr3,place_id)]\ntimestamp()\ns_cluster_seq <- s_class[,top_kk(place_id,N,10),by=list(x_100m,y_10m,hr3)]\ntimestamp()\ns_cluster_score <- s_class[,top_score_kk(place_id,N,10),by=list(x_100m,y_10m,hr3)]\ntimestamp()\ns_cluster_prc <- s_class[,top_prc_kk(place_id,N,10),by=list(x_100m,y_10m,hr3)]\ntimestamp()\n\ns_id_cluster_seq <- merge(test,s_cluster_seq,by=s_feat_list,all.x=TRUE)[order(row_id),list(row_id,V1)]\nsetnames(s_id_cluster_seq,c(\"row_id\",\"cluster_seq\"))\ns_id_cluster_score <- merge(test,s_cluster_score,by=s_feat_list,all.x=TRUE)[order(row_id),list(row_id,V1)]\nsetnames(s_id_cluster_score,c(\"row_id\",\"cluster_score\"))\ns_id_cluster_prc <- merge(test,s_cluster_prc,by=s_feat_list,all.x=TRUE)[order(row_id),list(row_id,V1)]\nsetnames(s_id_cluster_prc,c(\"row_id\",\"cluster_prc\"))\n\ns_dd_seq = as.data.frame(s_id_cluster_seq)\nfName = paste(class_name,\"_s_seq.csv\",sep = \"\");write.csv(s_dd_seq, file=fName, row.names=FALSE)\ns_dd_score = as.data.frame(s_id_cluster_score)\nfName = paste(class_name,\"_s_score.csv\",sep = \"\");write.csv(s_dd_score, file=fName, row.names=FALSE)\ns_dd_prc = as.data.frame(s_id_cluster_prc)\nfName = paste(class_name,\"_s_prc.csv\",sep = \"\");write.csv(s_dd_prc, file=fName, row.names=FALSE)\n#######################################\n\n#######################################\n# Class Y:\nclass_name   = \"Y\"\ns_feat_list = c(\"x_10m\",\"y_100m\",\"hr3\")\n\ns_class <- train[,list(.N),by=list(x_10m,y_100m,hr3,place_id)]\ntimestamp()\ns_cluster_seq <- s_class[,top_kk(place_id,N,10),by=list(x_10m,y_100m,hr3)]\ntimestamp()\ns_cluster_score <- s_class[,top_score_kk(place_id,N,10),by=list(x_10m,y_100m,hr3)]\ntimestamp()\ns_cluster_prc <- s_class[,top_prc_kk(place_id,N,10),by=list(x_10m,y_100m,hr3)]\ntimestamp()\n\ns_id_cluster_seq <- merge(test,s_cluster_seq,by=s_feat_list,all.x=TRUE)[order(row_id),list(row_id,V1)]\nsetnames(s_id_cluster_seq,c(\"row_id\",\"cluster_seq\"))\ns_id_cluster_score <- merge(test,s_cluster_score,by=s_feat_list,all.x=TRUE)[order(row_id),list(row_id,V1)]\nsetnames(s_id_cluster_score,c(\"row_id\",\"cluster_score\"))\ns_id_cluster_prc <- merge(test,s_cluster_prc,by=s_feat_list,all.x=TRUE)[order(row_id),list(row_id,V1)]\nsetnames(s_id_cluster_prc,c(\"row_id\",\"cluster_prc\"))\n\ns_dd_seq = as.data.frame(s_id_cluster_seq)\nfName = paste(class_name,\"_s_seq.csv\",sep = \"\");write.csv(s_dd_seq, file=fName, row.names=FALSE)\ns_dd_score = as.data.frame(s_id_cluster_score)\nfName = paste(class_name,\"_s_score.csv\",sep = \"\");write.csv(s_dd_score, file=fName, row.names=FALSE)\ns_dd_prc = as.data.frame(s_id_cluster_prc)\nfName = paste(class_name,\"_s_prc.csv\",sep = \"\");write.csv(s_dd_prc, file=fName, row.names=FALSE)\n#######################################\n\n#######################################\n# Class AA:\nclass_name   = \"AA\"\ns_feat_list = c(\"x_50m\",\"y_500m\",\"hr12\")\n\ns_class <- train[,list(.N),by=list(x_50m,y_500m,hr12,place_id)]\ntimestamp()\ns_cluster_seq <- s_class[,top_kk(place_id,N,10),by=list(x_50m,y_500m,hr12)]\ntimestamp()\ns_cluster_score <- s_class[,top_score_kk(place_id,N,10),by=list(x_50m,y_500m,hr12)]\ntimestamp()\ns_cluster_prc <- s_class[,top_prc_kk(place_id,N,10),by=list(x_50m,y_500m,hr12)]\ntimestamp()\n\ns_id_cluster_seq <- merge(test,s_cluster_seq,by=s_feat_list,all.x=TRUE)[order(row_id),list(row_id,V1)]\nsetnames(s_id_cluster_seq,c(\"row_id\",\"cluster_seq\"))\ns_id_cluster_score <- merge(test,s_cluster_score,by=s_feat_list,all.x=TRUE)[order(row_id),list(row_id,V1)]\nsetnames(s_id_cluster_score,c(\"row_id\",\"cluster_score\"))\ns_id_cluster_prc <- merge(test,s_cluster_prc,by=s_feat_list,all.x=TRUE)[order(row_id),list(row_id,V1)]\nsetnames(s_id_cluster_prc,c(\"row_id\",\"cluster_prc\"))\n\ns_dd_seq = as.data.frame(s_id_cluster_seq)\nfName = paste(class_name,\"_s_seq.csv\",sep = \"\");write.csv(s_dd_seq, file=fName, row.names=FALSE)\ns_dd_score = as.data.frame(s_id_cluster_score)\nfName = paste(class_name,\"_s_score.csv\",sep = \"\");write.csv(s_dd_score, file=fName, row.names=FALSE)\ns_dd_prc = as.data.frame(s_id_cluster_prc)\nfName = paste(class_name,\"_s_prc.csv\",sep = \"\");write.csv(s_dd_prc, file=fName, row.names=FALSE)\n#######################################\n\n#######################################\n# Class AB:\nclass_name   = \"AB\"\ns_feat_list = c(\"x_500m\",\"y_50m\",\"hr12\")\n\ns_class <- train[,list(.N),by=list(x_500m,y_50m,hr12,place_id)]\ntimestamp()\ns_cluster_seq <- s_class[,top_kk(place_id,N,10),by=list(x_500m,y_50m,hr12)]\ntimestamp()\ns_cluster_score <- s_class[,top_score_kk(place_id,N,10),by=list(x_500m,y_50m,hr12)]\ntimestamp()\ns_cluster_prc <- s_class[,top_prc_kk(place_id,N,10),by=list(x_500m,y_50m,hr12)]\ntimestamp()\n\ns_id_cluster_seq <- merge(test,s_cluster_seq,by=s_feat_list,all.x=TRUE)[order(row_id),list(row_id,V1)]\nsetnames(s_id_cluster_seq,c(\"row_id\",\"cluster_seq\"))\ns_id_cluster_score <- merge(test,s_cluster_score,by=s_feat_list,all.x=TRUE)[order(row_id),list(row_id,V1)]\nsetnames(s_id_cluster_score,c(\"row_id\",\"cluster_score\"))\ns_id_cluster_prc <- merge(test,s_cluster_prc,by=s_feat_list,all.x=TRUE)[order(row_id),list(row_id,V1)]\nsetnames(s_id_cluster_prc,c(\"row_id\",\"cluster_prc\"))\n\ns_dd_seq = as.data.frame(s_id_cluster_seq)\nfName = paste(class_name,\"_s_seq.csv\",sep = \"\");write.csv(s_dd_seq, file=fName, row.names=FALSE)\ns_dd_score = as.data.frame(s_id_cluster_score)\nfName = paste(class_name,\"_s_score.csv\",sep = \"\");write.csv(s_dd_score, file=fName, row.names=FALSE)\ns_dd_prc = as.data.frame(s_id_cluster_prc)\nfName = paste(class_name,\"_s_prc.csv\",sep = \"\");write.csv(s_dd_prc, file=fName, row.names=FALSE)\n#######################################\n\n#######################################\n# Class AC:\nclass_name   = \"AC\"\ns_feat_list = c(\"x_100m\",\"y_10m\",\"month\")\n\ns_class <- train[,list(.N),by=list(x_100m,y_10m,month,place_id)]\ntimestamp()\ns_cluster_seq <- s_class[,top_kk(place_id,N,10),by=list(x_100m,y_10m,month)]\ntimestamp()\ns_cluster_score <- s_class[,top_score_kk(place_id,N,10),by=list(x_100m,y_10m,month)]\ntimestamp()\ns_cluster_prc <- s_class[,top_prc_kk(place_id,N,10),by=list(x_100m,y_10m,month)]\ntimestamp()\n\ns_id_cluster_seq <- merge(test,s_cluster_seq,by=s_feat_list,all.x=TRUE)[order(row_id),list(row_id,V1)]\nsetnames(s_id_cluster_seq,c(\"row_id\",\"cluster_seq\"))\ns_id_cluster_score <- merge(test,s_cluster_score,by=s_feat_list,all.x=TRUE)[order(row_id),list(row_id,V1)]\nsetnames(s_id_cluster_score,c(\"row_id\",\"cluster_score\"))\ns_id_cluster_prc <- merge(test,s_cluster_prc,by=s_feat_list,all.x=TRUE)[order(row_id),list(row_id,V1)]\nsetnames(s_id_cluster_prc,c(\"row_id\",\"cluster_prc\"))\n\ns_dd_seq = as.data.frame(s_id_cluster_seq)\nfName = paste(class_name,\"_s_seq.csv\",sep = \"\");write.csv(s_dd_seq, file=fName, row.names=FALSE)\ns_dd_score = as.data.frame(s_id_cluster_score)\nfName = paste(class_name,\"_s_score.csv\",sep = \"\");write.csv(s_dd_score, file=fName, row.names=FALSE)\ns_dd_prc = as.data.frame(s_id_cluster_prc)\nfName = paste(class_name,\"_s_prc.csv\",sep = \"\");write.csv(s_dd_prc, file=fName, row.names=FALSE)\n#######################################\n\n#######################################\n# Class Rb:\nclass_name   = \"Rb\"\ns_feat_list = c(\"x_20m\",\"y_20m\")\n\ntmp1 = train[,.N,by=list(x_20m,y_20m,place_id)]\ntmp2 = train[,.N,by=list(place_id)]\ntmp3 = merge(tmp1,tmp2,by=\"place_id\")\n\ns_class <- train[,list(.N),by=list(x_20m,y_20m,place_id)]\ns_class <- merge(s_class,tmp3,by=c(\"place_id\",\"x_20m\",\"y_20m\"))\ntimestamp()\ns_cluster_seq <- s_class[,top_kk(place_id,N,10),by=list(x_20m,y_20m)]\ntimestamp()\ns_cluster_score <- s_class[,top_score_kk(place_id,N,10),by=list(x_20m,y_20m)]\ntimestamp()\ns_cluster_prc <- s_class[,top_prc_kk(place_id,N,10),by=list(x_20m,y_20m)]\ntimestamp()\ns_cluster_bprc <- s_class[,top_bprc_kk(place_id,N,10,bproc),by=list(x_20m,y_20m)]\ntimestamp()\n\ns_id_cluster_seq <- merge(test,s_cluster_seq,by=s_feat_list,all.x=TRUE)[order(row_id),list(row_id,V1)]\nsetnames(s_id_cluster_seq,c(\"row_id\",\"cluster_seq\"))\ns_id_cluster_score <- merge(test,s_cluster_score,by=s_feat_list,all.x=TRUE)[order(row_id),list(row_id,V1)]\nsetnames(s_id_cluster_score,c(\"row_id\",\"cluster_score\"))\ns_id_cluster_prc <- merge(test,s_cluster_bprc,by=s_feat_list,all.x=TRUE)[order(row_id),list(row_id,V1)]\nsetnames(s_id_cluster_prc,c(\"row_id\",\"cluster_prc\"))\n\ns_dd_seq = as.data.frame(s_id_cluster_seq)\nfName = paste(class_name,\"_s_seq.csv\",sep = \"\");write.csv(s_dd_seq, file=fName, row.names=FALSE)\ns_dd_score = as.data.frame(s_id_cluster_score)\nfName = paste(class_name,\"_s_score.csv\",sep = \"\");write.csv(s_dd_score, file=fName, row.names=FALSE)\ns_dd_prc = as.data.frame(s_id_cluster_prc)\nfName = paste(class_name,\"_s_prc.csv\",sep = \"\");write.csv(s_dd_prc, file=fName, row.names=FALSE)\n#######################################\n\n#######################################\n# Class AD:\nclass_name   = \"AD\"\ns_feat_list = c(\"x_500m\",\"y_20m\")\n\ns_class <- train[,list(.N),by=list(x_500m,y_20m,place_id)]\ntimestamp()\ns_cluster_seq <- s_class[,top_kk(place_id,N,10),by=list(x_500m,y_20m)]\ntimestamp()\ns_cluster_score <- s_class[,top_score_kk(place_id,N,10),by=list(x_500m,y_20m)]\ntimestamp()\ns_cluster_prc <- s_class[,top_prc_kk(place_id,N,10),by=list(x_500m,y_20m)]\ntimestamp()\n\ns_id_cluster_seq <- merge(test,s_cluster_seq,by=s_feat_list,all.x=TRUE)[order(row_id),list(row_id,V1)]\nsetnames(s_id_cluster_seq,c(\"row_id\",\"cluster_seq\"))\ns_id_cluster_score <- merge(test,s_cluster_score,by=s_feat_list,all.x=TRUE)[order(row_id),list(row_id,V1)]\nsetnames(s_id_cluster_score,c(\"row_id\",\"cluster_score\"))\ns_id_cluster_prc <- merge(test,s_cluster_prc,by=s_feat_list,all.x=TRUE)[order(row_id),list(row_id,V1)]\nsetnames(s_id_cluster_prc,c(\"row_id\",\"cluster_prc\"))\n\ns_dd_seq = as.data.frame(s_id_cluster_seq)\nfName = paste(class_name,\"_s_seq.csv\",sep = \"\");write.csv(s_dd_seq, file=fName, row.names=FALSE)\ns_dd_score = as.data.frame(s_id_cluster_score)\nfName = paste(class_name,\"_s_score.csv\",sep = \"\");write.csv(s_dd_score, file=fName, row.names=FALSE)\ns_dd_prc = as.data.frame(s_id_cluster_prc)\nfName = paste(class_name,\"_s_prc.csv\",sep = \"\");write.csv(s_dd_prc, file=fName, row.names=FALSE)\n#######################################\n\n#######################################\n# Class AE:\nclass_name   = \"AE\"\ns_feat_list = c(\"x_200m\",\"y_20m\")\n\ns_class <- train[,list(.N),by=list(x_200m,y_20m,place_id)]\ntimestamp()\ns_cluster_seq <- s_class[,top_kk(place_id,N,10),by=list(x_200m,y_20m)]\ntimestamp()\ns_cluster_score <- s_class[,top_score_kk(place_id,N,10),by=list(x_200m,y_20m)]\ntimestamp()\ns_cluster_prc <- s_class[,top_prc_kk(place_id,N,10),by=list(x_200m,y_20m)]\ntimestamp()\n\ns_id_cluster_seq <- merge(test,s_cluster_seq,by=s_feat_list,all.x=TRUE)[order(row_id),list(row_id,V1)]\nsetnames(s_id_cluster_seq,c(\"row_id\",\"cluster_seq\"))\ns_id_cluster_score <- merge(test,s_cluster_score,by=s_feat_list,all.x=TRUE)[order(row_id),list(row_id,V1)]\nsetnames(s_id_cluster_score,c(\"row_id\",\"cluster_score\"))\ns_id_cluster_prc <- merge(test,s_cluster_prc,by=s_feat_list,all.x=TRUE)[order(row_id),list(row_id,V1)]\nsetnames(s_id_cluster_prc,c(\"row_id\",\"cluster_prc\"))\n\ns_dd_seq = as.data.frame(s_id_cluster_seq)\nfName = paste(class_name,\"_s_seq.csv\",sep = \"\");write.csv(s_dd_seq, file=fName, row.names=FALSE)\ns_dd_score = as.data.frame(s_id_cluster_score)\nfName = paste(class_name,\"_s_score.csv\",sep = \"\");write.csv(s_dd_score, file=fName, row.names=FALSE)\ns_dd_prc = as.data.frame(s_id_cluster_prc)\nfName = paste(class_name,\"_s_prc.csv\",sep = \"\");write.csv(s_dd_prc, file=fName, row.names=FALSE)\n#######################################\n\n\n# try grid to find the best params\nestRet = list();\nestRet0 = list();\nestGrid = list();\n\n#for (prm in c(\"A\",\"B\",\"D\",\"E\",\"F\",\"G\",\"H\",\"I\",\"J\",\"K\",\"L\",\"M\",\"N\",\"Q\",\"R\",\"S\",\"T\",\"U\",\"V\",\"X\",\"Y\",\"AA\",\"AB\",\"AC\"))\nfor (prm in c(\"AE\"))\n{\n  params = paste(c(prm, \" 1 C 0.01 \"),collapse = \" \"); print(params);\n\n########################################\n\n#params = \"A 0.5 B 1.0       C 0.01\" # 0.348030596682419\n#params = \"A 0.5 B 1.0 D 0.8 C 0.01\" # 0.384122833791672\n#params = \"A 0.8 B 1.0 D 1.5 C 0.01\" # 0.39362668519067\n#params = \"A 1.0 B 1.0 D 1.5 C 0.01\" # 0.390993354714123\n#params = \"A 0.6 B 0.6 D 0.8 C 0.01\" # 0.3883455\n#params = \"A 0.6 B 0.6 D 1.1 C 0.01\" # 0.3943643\n#params = \"A 0.6 B 0.6 D 1.4 C 0.01\" # 0.3969154\n#params = \"A 0.6 B 0.8 D 0.8 C 0.01\" # 0.3854395\n#params = \"A 0.6 B 0.8 D 1.1 C 0.01\" # 0.3928231\n#params = \"A 0.6 B 0.8 D 1.4 C 0.01\" # 0.3960644\n#params = \"A 0.6 B 1.0 D 0.8 C 0.01\" # 0.3817084\n#params = \"A 0.6 B 1.0 D 1.1 C 0.01\" # 0.3906833\n#params = \"A 0.6 B 1.0 D 1.4 C 0.01\" # 0.3947414\n#params = \"A 0.6 B 1.4 D 0.8 C 0.01\" # 0.37273\n#params = \"A 0.6 B 1.4 D 1.1 C 0.01\" # 0.3849941\n#params = \"A 0.6 B 1.4 D 1.4 C 0.01\" # 0.3910011\n#params = \"A 0.6 B 2.0 D 0.8 C 0.01\" # 0.3570476\n#params = \"A 0.6 B 2.0 D 1.1 C 0.01\" # 0.3744507\n#params = \"A 0.6 B 2.0 D 1.4 C 0.01\" # 0.3834924\n#params = \"A 0.8 B 0.6 D 0.8 C 0.01\" # 0.3816596\n#params = \"A 0.8 B 0.6 D 1.1 C 0.01\" # 0.3904607\n#params = \"A 0.8 B 0.6 D 1.4 C 0.01\" # 0.3944332\n#params = \"A 0.8 B 0.8 D 0.8 C 0.01\" # 0.3790553\n#params = \"A 0.8 B 0.8 D 1.1 C 0.01\" # 0.3890995\n#params = \"A 0.8 B 0.8 D 1.4 C 0.01\" # 0.3936869\n#params = \"A 1.0 B 0.8 D 2.0 C 0.01\" # 0.395882769518992\n#params = \"A 0.6 B 0.6 D 1.4 C 0.01 E 0.4\" # 0.417654814010682\n#params = \"A 0.6 B 0.6 D 1.4 C 0.01 E 0.4 F 0.2\" #0.419578784402348\n#params = \"A 0.6 B 0.6 D 1.4 C 0.01 E 0.6 F 0.4\" #0.422525233692637\n#params = \"A 0.6 B 0.6 D 1.4 C 0.01 E 0.8 F 0.6\" #0.424432013247469\n#params = \"A 0.6 B 0.6 D 1.4 C 0.01 E 0.8 F 0.6 G 0.8\" #0.433309501721339\n#params = \"A 0.6 B 0.6 D 1.4 C 0.01 E 0.8 F 0.6 G 0.8 H 0.8\" #0.437059960937206\n#params = \"A 0.6 B 0.6 D 1.4 C 0.01 E 1.0 F 0.8 G 1.0 H 1.0\" #0.437082464394168\n#params = \"A 0.6 B 0.6 D 1.4 C 0.01 E 1.0 F 0.8 G 1.0 H 1.0 I 1.0 J 1.0\" #.437313287714967\n\n#params = \"A 0.6 B 0.6 D 1.4 C 0.01 E 1.0 F 0.8 G 1.0 H 1.0 I 1.0 J 1.0 K 0.6 L 0.6\" #0.43835603977248\n\n#params = \"A 0.6 B 0.6 D 4.0 C 0.01 E 1.0 F 0.8 G 1.0 H 1.0 I 1.0 J 1.0 K 0.6 L 0.6\" #0.437473518342823\n\n#params = \"A 0.6 B 0.6 D 0.5 C 0.01 E 1.0 F 0.8 G 1.0 H 1.0 I 1.0 J 1.0 K 0.6 L 0.6\" #0.4361711\n  # after bug fix:\n#params = \"A 0.6 B 0.6 D 0.5  C 0.01  E 1.0  F 0.8 G 1.0 H 1.0 I 1.0 J 1.0 K 0.6 L 0.6\" #0.4377005 -> 0.451961785866803\n#params = \"A 0.6 B 0.6 D 1.0  C 0.01  E 1.0  F 0.8 G 1.0 H 1.0 I 1.0 J 1.0 K 0.6 L 0.6\" #0  0.453546511057242\n#params = \"A 0.6 B 0.6 D 2.0  C 0.01  E 1.0  F 0.8 G 1.0 H 1.0 I 1.0 J 1.0 K 0.6 L 0.6\" #0.4387098 -> 0.454592374114073\n#params = \"A 0.6 B 0.6 D 2.5  C 0.01  E 1.0  F 0.8 G 1.0 H 1.0 I 1.0 J 1.0 K 0.6 L 0.6\" #0.4386367 -> 0.454516577151467\n#params = \"A 0.6 B 0.6 D 5.0  C 0.01  E 0.4  F 0.8 G 1.5 H 1.5 I 0.5 J 0.5 K 1.0 L 1.0\" #0.435326894036784\n\n#params = \"A 0.2 B 0.4 D 0.45 C 0.004 E 0.45 F 0.4 G 0.3 H 0.3 I 0.1 J 0.1 K 0.1 L 0.1\"                              # 0.456648188203313\n#params = \"A 0.2 B 0.4 D 0.45 C 0.004 E 0.45 F 0.4 G 0.3 H 0.3 I 0.1 J 0.1 K 0.1 L 0.1 U 0.4 V 0.4 X 0.5 Y 0.4\"      # 0.477563969234794\n#params = \"A 0.04 B 0.16 D 0.20 C 0.001 E 0.20 F 0.16 G 0.1 H 0.1                     U 0.16 V 0.16 X 0.25 Y 0.16\"              # 0.479717626063021\n   \n  params = \"A 0.04 B 0.16 D 0.40 C 0.001 E 0.40 F 0.16 G 0.1 H 0.1                     U 0.16 V 0.16 X 0.50 Y 0.16\"              # 0.48273252230843\n  \n  #params = \"A 0.04 B 0.16 D 0.50 C 0.001 E 0.50 F 0.16 G 0.1 H 0.1                     U 0.16 V 0.16 X 0.60 Y 0.16\"              # 0.482621047022213\n  #params = \"A 0.04 B 0.16 D 0.40 C 0.001 E 0.40 F 0.16 G 0.1 H 0.1                     U 0.16 V 0.16 X 0.50 Y 0.16              AE 0.1\" # 0.482202125337483\n  #params = \"A 0.04 B 0.16 D 0.20 C 0.001 E 0.20 F 0.16 G 0.1 H 0.1                     U 0.16 V 0.16 X 0.25 Y 0.16 AC 0.04\"      # 0.479674962681876\n  \n#params = \"A 0.2 B 0.4 D 0.45 C 0.004 E 0.45 F 0.4 G 0.3 H 0.3 I 0.1 J 0.1 K 0.1 L 0.1 U 0.4 V 0.4 X 0.5 Y 0.4 AC 0.35\"      # 0.477142970209535\n\n#params = \"A 0.2 B 0.4 D 0.45 C 0.004 E 0.45 F 0.4 G 0.3 H 0.3 I 0.1 J 0.1 K 0.1 L 0.1 U 0.4 V 0.4 X 0.5 Y 0.4 AC 0.20\"      # 0.477560333888866\n  \n#params = \"A 0.2 B 0.4 D 0.90 C 0.004 E 0.90 F 0.8 G 0.3 H 0.3 I 0.1 J 0.1 K 0.1 L 0.1\"                              # 0.455391397182368\n#params = \"A 0.2 B 0.4 D 0.45 C 0.004 E 0.45 F 0.4 G 0.3 H 0.3                        \"                              # 0.45515390522622\n#params = \"A 0.2 B 0.4 D 0.45 C 0.004 E 0.45 F 0.4 G 0.3 H 0.3                                              R 0.43\"  #0.45641897964253\n#params = \"                   C 0.004                                                                                 S 0.35 T 0.35\"  #00.388628217274655\n  \n  \n  #params = \"C 0.01\"     #0.0041925405921428\n\n  #params = \"A 1 C 0.01\" #0.227409505982974\n  #params = \"B 1 C 0.01\" #0.3840512\n  #params = \"D 1 C 0.01\" #0.4339639\n  #params = \"E 1 C 0.01\" #0.4337672\n  #params = \"F 1 C 0.01\" #0.419227\n  #params = \"G 1 C 0.01\" #0.2962402\n  #params = \"H 1 C 0.01\" #0.2836872\n  #params = \"I 1 C 0.01\" #0.1245319\n  #params = \"J 1 C 0.01\" #0.1175754\n  #params = \"K 1 C 0.01\" #0.12663\n  #params = \"L 1 C 0.01\" #0.1194116  \n  #params = \"M 1 C 0.01\" #0.36936470096761\n  #params = \"N 1 C 0.01\" #0.352560262480285\n  #params = \"Q 1 C 0.01\" #0.377673491820913\n  #params = \"R 1 C 0.01\" #0.435650585921687\n  #params = \"S 1 C 0.01\" #0.3575213\n  #params = \"T 1 C 0.01\" #0.3418761\n  #\n  #\n  \n# Call the ensembler:\nwrkDir = \"/Users/user/Projects/Kaggle/Kaggle-Facebook/C/Build/Products/Debug/\"\ncmd = \"ensembler \"\ncmdLine = paste(c(wrkDir,cmd,params),collapse = \"\")\ncmdLineCode = paste(unlist(strsplit(params,split=\" \")),collapse = \"\")\ntimestamp()\nsystem(cmdLine)\ntimestamp()\n########################################\n\n# The result is in \"out.csv\", make  copy for future ensembling:\nif (validation == 1)\n{\n  fn = paste(c(\"v_\",cmdLineCode,\".csv\"),collapse=\"\")\n  system(paste(c(\"cp out.csv \",fn),collapse=\"\"))\n  # if you want to reload the data produced by fn, update fn and run:\n  # dd=loadSubmission(fn)\n  # system(paste(c(\"cp \",fn,\" out.csv \"),collapse=\"\"))\n\n}\nif (validation == 0)\n{\n  fn = paste(c(\"p_\",cmdLineCode,\".csv\"))\n  system(paste(c(\"cp out.csv \",fn),collapse=\"\"))\n}\n\nif (validation == 0)\n{\n  subFile = paste(c(\"submission\",subName),collapse=\"\")\n  system(paste(c(\"cp out.csv \",subFile),collapse=\"\"))\n}\n\n# Error estimation:\ndd = loadSubmission(\"out.csv\")\ndd$V5 <- NULL  # quick bug workaround\n\nif (validation == 1)\n{\n  estE = errMeasure1(dd,test$place_id)\n  estE0 = errMeasure1(dd,test$place_id,idx0)\n  #print(c(\"error:\", estE[[1]],count(estE[[2]])))\n  print(c(\"error:\", estE))\n  print(c(\"error:\", estE0))\n}\n\nestRet[[params]] = estE;\nestRet0[[params]] = estE0;\n# Grid error (1km square cells):\nestRetGrid = matrix(nrow=10, ncol=10)\nfor (ii in (1:10)) for (jj in (1:10))\n{\n  x1=ii-1; x2=ii;\n  y1=jj-1; y2=jj;\n  idx_xy = which (test$x>=x1 & test$x<=x2 & test$y>=y1 & test$y<=y2)\n  estRetGrid[ii,jj] = errMeasure1(dd,test$place_id,idx_xy)\n}\nestGrid[[params]] = estRetGrid;\n}\nsave(estGrid,file=\"estGrid.rda\")\n\n# IMPORTANT:  Missed points analysis:\n# Totally missed - small analysis:\nidx0 = which((dd$V2 != test$place_id) & (dd$V3!=test$place_id) & (dd$V4!=test$place_id))\nidx123 = which((dd$V2 == test$place_id) | (dd$V3 == test$place_id) | (dd$V4 == test$place_id))\nestE0 = errMeasure1(dd,test$place_id,idx0) # missed points error\nestE123 = errMeasure1(dd,test$place_id,idx123) # guessed points error\n\n# The most missed place_id:\nNmax = max(test[idx0,.N,by=place_id]$N)\nImax_sort = sort(test[idx0,.N,by=place_id]$N, decreasing = TRUE)\nImax = which(test[idx0,.N,by=place_id]$N == Imax_sort[1]) # change to 2, 3, etc\npid = test[idx0,.N,by=place_id][Imax]$place_id\nidxpid = which(test$place_id == pid) # all the lines with that place\nidx0pid = idxpid[which(idxpid %in% idx0)] # all the missed lines with that place\nidxtrainpid = which(train$place_id == pid)\nplot(train[idxtrainpid,]$x ,train[idxtrainpid,]$y)\nplot(test[idx0pid,]$x ,test[idx0pid,]$y)\nplot(train[idxtrainpid,]$time ,train[idxtrainpid,]$x)\nplot(train[idxtrainpid,]$time ,train[idxtrainpid,]$y)\nplot(test[idx0pid,]$time ,test[idx0pid,]$x)\nplot(test[idx0pid,]$time ,test[idx0pid,]$y)\n\n# Grid error (1km square cells):\nestRetGrid = matrix(nrow=10, ncol=10)\nfor (ii in (1:10)) for (jj in (1:10))\n{\n  x1=ii-1; x2=ii;\n  y1=jj-1; y2=jj;\n  idx_xy = which (test$x>=x1 & test$x<=x2 & test$y>=y1 & test$y<=y2)\n  estRetGrid[ii,jj] = errMeasure1(dd,test$place_id,idx_xy)\n}\n\n\n\nmax((estRetGrid))\n\n# combine:\norderSubmission(\"submission.public.005.1.csv\")\ncombineSubmission(\"submission.wip.005.A.csv\",c(\"submission.wip.005.csv 0.1 submission.public.005.1.csv 0.9\"))\nss1 = loadSubmission(\"submission.wip.005.A.csv\");    # submission combined\nss1$V5 <- NULL\nss2 = loadSubmission(\"submission.public.005.1.csv\") # public\nss3 = loadSubmission(\"submission.wip.005.csv\")      # produced\nss3$V5 <- NULL\n# 0.58374\n\n# combine:\norderSubmission(\"submission.public.005.1.csv\")\ncombineSubmission(\"submission.wip.005.B.csv\",c(\"submission.wip.005.csv 0.2 submission.public.005.1.csv 0.8\"))\nss1 = loadSubmission(\"submission.wip.005.B.csv\");    # submission combined\nss1$V5 <- NULL\nss2 = loadSubmission(\"submission.public.005.1.csv\") # public\nss3 = loadSubmission(\"submission.wip.005.csv\")      # produced\nss3$V5 <- NULL\n# 0.58350\n\n# combine only the border 100m:\norderSubmission(\"submission.public.005.1.csv\")\ncombineSubmission(\"submission.wip.005.A.csv\",c(\"submission.wip.005.csv 0.1 submission.public.005.1.csv 0.9\"))\nss1 = loadSubmission(\"submission.wip.005.A.csv\");    # submission combined\nss1$V5 <- NULL\nss2 = loadSubmission(\"submission.public.005.1.csv\") # public\nss3 = loadSubmission(\"submission.wip.005.csv\")      # produced\nss3$V5 <- NULL\n\nidx = which(test$x_100m ==0 | test$x_100m==99 | test$y_100m==0 | test$y_100m==99)\nss2[idx,] = ss1[idx,]\nwriteSubmission(ss2,\"submission.wip.005.C.csv\")\n# 0.58372\n\n# combine:\norderSubmission(\"submission.public.005.1.csv\")\ncombineSubmission(\"submission.wip.005.D.csv\",c(\"submission.wip.005.csv 0.15 submission.public.005.1.csv 0.85\"))\nss1 = loadSubmission(\"submission.wip.005.A.csv\");    # submission combined\nss1$V5 <- NULL\nss2 = loadSubmission(\"submission.public.005.1.csv\") # public\nss3 = loadSubmission(\"submission.wip.005.csv\")      # produced\nss3$V5 <- NULL\n# 0.58374\n\n\n\n",
    "created" : 1467889580741.000,
    "dirty" : false,
    "encoding" : "UTF-8",
    "folds" : "",
    "hash" : "2812294329",
    "id" : "90407F1F",
    "lastKnownWriteTime" : 1468123594,
    "path" : "~/Projects/Kaggle/Kaggle-Bimbo/R/wip.000.R",
    "project_path" : "wip.000.R",
    "properties" : {
    },
    "relative_order" : 1,
    "source_on_save" : false,
    "type" : "r_source"
}